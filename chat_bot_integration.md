# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Allkinds Chat Bot

## 1. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ —á–∞—Ç-–±–æ—Ç

```python
# –§–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏
https://t.me/{ALLKINDS_CHAT_BOT_USERNAME}?start=match_{user_id}_{match_user_id}

# –ì–¥–µ:
user_id - telegram_user_id –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ —á–∞—Ç–∞
match_user_id - telegram_user_id –º—ç—Ç—á–∞
```

## 2. –î–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —á–∞—Ç-–±–æ—Ç–∞

```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º—ç—Ç—á–µ
SELECT 
    gm1.nickname as initiator_nickname,
    gm1.photo_url as initiator_photo,
    gm2.nickname as match_nickname,
    gm2.photo_url as match_photo,
    g.name as group_name,
    g.id as group_id
FROM group_members gm1
JOIN group_members gm2 ON gm2.group_id = gm1.group_id
JOIN groups g ON g.id = gm1.group_id
WHERE 
    gm1.user_id = (SELECT id FROM users WHERE telegram_user_id = :initiator_id)
    AND gm2.user_id = (SELECT id FROM users WHERE telegram_user_id = :match_id)
    AND gm1.group_id = gm2.group_id;
```

## 3. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —á–∞—Ç-–±–æ—Ç–∞

```python
POINTS_TO_CONNECT = 10  # –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ —á–∞—Ç
MIN_ANSWERS_FOR_MATCH = 5  # –ú–∏–Ω–∏–º—É–º –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –º—ç—Ç—á–∞
```

## 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ –º—ç—Ç—á–µ–π
CREATE TABLE match_statuses (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    group_id INTEGER REFERENCES groups(id) ON DELETE CASCADE,
    match_user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    status VARCHAR(16) NOT NULL,  -- 'hidden' | 'postponed'
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, group_id, match_user_id)
);
```

## 5. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

```python
POSTGRES_USER = 'allkinds'
POSTGRES_PASSWORD = 'allkinds'
POSTGRES_DB = 'allkinds'
POSTGRES_HOST = 'localhost'  # –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Ö–æ—Å—Ç
POSTGRES_PORT = 5432
```

## 6. –î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –ª–æ–≥–∏–∫–∞ –º–∞—Ç—á–∏–Ω–≥–∞ (Two-Stage Matching)

### –û–ø–∏—Å–∞–Ω–∏–µ
–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –º–∞—Ç—á–µ–π –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ —á–∞—Ç-–±–æ—Ç.

### –ü—Ä–æ—Ü–µ—Å—Å
1. **–ò–Ω–∏—Ü–∏–∞—Ü–∏—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –Ω–∞–∂–∏–º–∞–µ—Ç "Connect" —É –º–∞—Ç—á–∞
2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B –ø–æ–ª—É—á–∞–µ—Ç:
   - –°–æ–æ–±—â–µ–Ω–∏–µ: "{nickname} —Ö–æ—á–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –≤–∞–º"
   - –ö–∞—Ä—Ç–æ—á–∫—É –º–∞—Ç—á–∞ —Å —Ñ–æ—Ç–æ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
   - –¢—Ä–∏ –∫–Ω–æ–ø–∫–∏: "–ü—Ä–∏–Ω—è—Ç—å", "–û—Ç–∫–ª–æ–Ω–∏—Ç—å", "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å"
3. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ—à–µ–Ω–∏–∏

### –°—Ç–∞—Ç—É—Å—ã –≤ MatchStatus
- `pending_approval` - –û–∂–∏–¥–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è –æ—Ç –≤—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `accepted` - –ó–∞–ø—Ä–æ—Å –ø—Ä–∏–Ω—è—Ç, —Å–æ–∑–¥–∞–µ—Ç—Å—è Match –∑–∞–ø–∏—Å—å
- `rejected` - –ó–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω–µ–Ω
- `blocked` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (+ –æ–±—Ä–∞—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å —Å `hidden`)

### –ò—Å–∫–ª—é—á–µ–Ω–∏—è –≤ find_best_match
–§—É–Ω–∫—Ü–∏—è –∏—Å–∫–ª—é—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏:
- `hidden`, `postponed` (—Å—Ç–∞—Ä—ã–µ)
- `pending_approval`, `rejected`, `blocked` (–Ω–æ–≤—ã–µ)

### –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
```python
MATCH_REQUEST_SENT = "üîî –ú—ã —É–≤–µ–¥–æ–º–∏–ª–∏ {nickname} –æ –≤–∞—à–µ–º –∏–Ω—Ç–µ—Ä–µ—Å–µ..."
MATCH_INCOMING_REQUEST = "üíå {nickname} —Ö–æ—á–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –≤–∞–º"
MATCH_REQUEST_ACCEPTED = "‚úÖ {nickname} –ø—Ä–∏–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å..."
MATCH_REQUEST_REJECTED = "üòî {nickname} –æ—Ç–∫–ª–æ–Ω–∏–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å..."
MATCH_REQUEST_BLOCKED = "üö´ {nickname} —Ä–µ—à–∏–ª –Ω–µ –æ–±—â–∞—Ç—å—Å—è —Å –≤–∞–º–∏ üòû"

BTN_ACCEPT_MATCH = "‚úÖ –ü—Ä–∏–Ω—è—Ç—å"
BTN_REJECT_MATCH = "‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å"  
BTN_BLOCK_MATCH = "üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å"
BTN_GO_TO_CHAT = "üí¨ –ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç"
```

### –ù–æ–≤—ã–µ —Ö—ç–Ω–¥–ª–µ—Ä—ã
- `cb_accept_match` - –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –º–∞—Ç—á
- `cb_reject_match` - –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –º–∞—Ç—á  
- `cb_block_match` - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ cb_match_chat
- –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ—Ç `MatchStatus` —Å `pending_approval`
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Ç–æ—Ä–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –ù–µ —Å–æ–∑–¥–∞–µ—Ç —Å—Ä–∞–∑—É `Match` –∑–∞–ø–∏—Å—å

## 7. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º—ç—Ç—á–∞ –≤ –ë–î
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º—ç—Ç—á–∞ (hidden/postponed)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤

## 8. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –ß–∞—Ç-–±–æ—Ç –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—É –∂–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–ª–∞–º–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –º—ç—Ç—á–µ–π –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã–º–∏
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –±–æ—Ç–∞–º–∏ 